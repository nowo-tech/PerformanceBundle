{# Filters Component (Bootstrap) #}
{# This component can be overridden by creating: templates/bundles/NowoPerformanceBundle/Performance/components/_filters_bootstrap.html.twig #}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">{{ 'filters.title'|trans({}, 'nowo_performance') }}</h5>
                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters" aria-expanded="false" aria-controls="advancedFilters">
                    <span class="when-expanded">{{ 'filters.hide_advanced'|trans({}, 'nowo_performance') }}</span>
                    <span class="when-collapsed">{{ 'filters.show_advanced'|trans({}, 'nowo_performance') }}</span>
                </button>
            </div>
            <div class="card-body">
                {{ form_start(form, {'action': path('nowo_performance.index'), 'attr': {'class': 'row g-3'}}) }}
                    {# Basic Filters #}
                    <div class="col-md-3">
                        {{ form_label(form.env) }}
                        {{ form_widget(form.env) }}
                        {{ form_errors(form.env) }}
                    </div>
                    <div class="col-md-3">
                        {{ form_label(form.route) }}
                        {{ form_widget(form.route) }}
                        {{ form_errors(form.route) }}
                    </div>
                    <div class="col-md-2">
                        {{ form_label(form.sort) }}
                        {{ form_widget(form.sort) }}
                        {{ form_errors(form.sort) }}
                    </div>
                    <div class="col-md-2">
                        {{ form_label(form.order) }}
                        {{ form_widget(form.order) }}
                        {{ form_errors(form.order) }}
                    </div>
                    <div class="col-md-2">
                        {{ form_label(form.limit) }}
                        {{ form_widget(form.limit) }}
                        {{ form_errors(form.limit) }}
                    </div>

                    {# Advanced Filters (Collapsible) #}
                    <div class="collapse" id="advancedFilters">
                        <div class="col-12">
                            <hr class="my-4">
                            <div class="d-flex align-items-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="text-primary me-2" viewBox="0 0 16 16">
                                    <path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                                <h6 class="mb-0 fw-bold">{{ 'filters.advanced_filters'|trans({}, 'nowo_performance') }}</h6>
                            </div>
                        </div>
                        
                        {# Request Time Range #}
                        <div class="col-12 mb-3">
                            <div class="card border-primary">
                                <div class="card-header bg-primary bg-opacity-10 py-2">
                                    <small class="fw-semibold text-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                                        </svg>
                                        {{ 'filters.request_time_range'|trans({}, 'nowo_performance') }}
                                    </small>
                                </div>
                                <div class="card-body py-3">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            {{ form_label(form.min_request_time, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">{{ 'filters.min'|trans({}, 'nowo_performance') }}</span>
                                                {{ form_widget(form.min_request_time, {'attr': {'class': 'form-control', 'placeholder': '0.0000'}}) }}
                                            </div>
                                            {{ form_errors(form.min_request_time) }}
                                        </div>
                                        <div class="col-md-6">
                                            {{ form_label(form.max_request_time, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">{{ 'filters.max'|trans({}, 'nowo_performance') }}</span>
                                                {{ form_widget(form.max_request_time, {'attr': {'class': 'form-control', 'placeholder': '1.0000'}}) }}
                                            </div>
                                            {{ form_errors(form.max_request_time) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {# Query Count Range #}
                        <div class="col-12 mb-3">
                            <div class="card border-info">
                                <div class="card-header bg-info bg-opacity-10 py-2">
                                    <small class="fw-semibold text-info">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
                                            <path d="M4.268 1H12a1 1 0 0 1 1 1v11.768l.223.148A.5.5 0 0 0 14 13.5V2a2 2 0 0 0-2-2H6a2 2 0 0 0-1.732 1z"/>
                                        </svg>
                                        {{ 'filters.query_count_range'|trans({}, 'nowo_performance') }}
                                    </small>
                                </div>
                                <div class="card-body py-3">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            {{ form_label(form.min_query_count, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">{{ 'filters.min'|trans({}, 'nowo_performance') }}</span>
                                                {{ form_widget(form.min_query_count, {'attr': {'class': 'form-control', 'placeholder': '0'}}) }}
                                            </div>
                                            {{ form_errors(form.min_query_count) }}
                                        </div>
                                        <div class="col-md-6">
                                            {{ form_label(form.max_query_count, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">{{ 'filters.max'|trans({}, 'nowo_performance') }}</span>
                                                {{ form_widget(form.max_query_count, {'attr': {'class': 'form-control', 'placeholder': '100'}}) }}
                                            </div>
                                            {{ form_errors(form.max_query_count) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {# Date Range #}
                        <div class="col-12 mb-3">
                            <div class="card border-success">
                                <div class="card-header bg-success bg-opacity-10 py-2">
                                    <small class="fw-semibold text-success">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                        </svg>
                                        {{ 'filters.date_range'|trans({}, 'nowo_performance') }}
                                    </small>
                                </div>
                                <div class="card-body py-3">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            {{ form_label(form.date_from, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M8 4a.5.5 0 0 1 .5.5v3.5a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4z"/>
                                                        <path d="M8 0a5 5 0 0 0-5 5c0 .676.13 1.323.367 1.916l.01.03.01.03c.1.27.2.52.3.73a5.5 5.5 0 0 0 8.646 0l.01-.03.01-.03c.237-.593.367-1.24.367-1.916A5 5 0 0 0 8 0zM5 5a3 3 0 1 1 6 0c0 .314-.06.616-.17.9l-.01.03-.01.03a4.5 4.5 0 0 1-5.64 0l-.01-.03-.01-.03A2.9 2.9 0 0 1 5 5z"/>
                                                    </svg>
                                                </span>
                                                {{ form_widget(form.date_from, {'attr': {'class': 'form-control'}}) }}
                                            </div>
                                            {{ form_errors(form.date_from) }}
                                        </div>
                                        <div class="col-md-6">
                                            {{ form_label(form.date_to, null, {'attr': {'class': 'form-label small text-muted'}}) }}
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M8 4a.5.5 0 0 1 .5.5v3.5a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4z"/>
                                                        <path d="M8 0a5 5 0 0 0-5 5c0 .676.13 1.323.367 1.916l.01.03.01.03c.1.27.2.52.3.73a5.5 5.5 0 0 0 8.646 0l.01-.03.01-.03c.237-.593.367-1.24.367-1.916A5 5 0 0 0 8 0zM5 5a3 3 0 1 1 6 0c0 .314-.06.616-.17.9l-.01.03-.01.03a4.5 4.5 0 0 1-5.64 0l-.01-.03-.01-.03A2.9 2.9 0 0 1 5 5z"/>
                                                    </svg>
                                                </span>
                                                {{ form_widget(form.date_to, {'attr': {'class': 'form-control'}}) }}
                                            </div>
                                            {{ form_errors(form.date_to) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        {{ form_widget(form.submit) }}
                        <a href="{{ path('nowo_performance.index') }}" class="btn btn-secondary">Reset</a>
                    </div>
                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const collapseElement = document.getElementById('advancedFilters');
    const toggleButton = document.querySelector('[data-bs-target="#advancedFilters"]');
    
    if (collapseElement && toggleButton) {
        // Check if any advanced filter has a value
        const hasAdvancedFilters = 
            document.querySelector('input[name="min_request_time"]')?.value ||
            document.querySelector('input[name="max_request_time"]')?.value ||
            document.querySelector('input[name="min_query_count"]')?.value ||
            document.querySelector('input[name="max_query_count"]')?.value ||
            document.querySelector('input[name="date_from"]')?.value ||
            document.querySelector('input[name="date_to"]')?.value;

        if (hasAdvancedFilters) {
            // Auto-expand if filters are active
            const bsCollapse = new bootstrap.Collapse(collapseElement, { toggle: false });
            bsCollapse.show();
            toggleButton.setAttribute('aria-expanded', 'true');
            toggleButton.querySelector('.when-expanded').style.display = 'inline';
            toggleButton.querySelector('.when-collapsed').style.display = 'none';
        }

        // Toggle button text
        collapseElement.addEventListener('show.bs.collapse', function() {
            toggleButton.querySelector('.when-expanded').style.display = 'inline';
            toggleButton.querySelector('.when-collapsed').style.display = 'none';
        });

        collapseElement.addEventListener('hide.bs.collapse', function() {
            toggleButton.querySelector('.when-expanded').style.display = 'none';
            toggleButton.querySelector('.when-collapsed').style.display = 'inline';
        });
    }
});
</script>
