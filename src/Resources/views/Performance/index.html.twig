<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Metrics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
        }
        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }
    </style>
</head>
<body>

{% block body %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1>Performance Metrics Dashboard</h1>
            <p class="text-muted">Monitor and analyze route performance metrics</p>
        </div>
    </div>

    {# Statistics Cards #}
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Routes</h5>
                    <h2 class="text-primary">{{ stats.total_routes }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Queries</h5>
                    <h2 class="text-info">{{ stats.total_queries }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Avg Request Time</h5>
                    <h2 class="text-warning">{{ (stats.avg_request_time * 1000)|number_format(2) }} ms</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Max Request Time</h5>
                    <h2 class="text-danger">{{ (stats.max_request_time * 1000)|number_format(2) }} ms</h2>
                </div>
            </div>
        </div>
    </div>

    {# Filters #}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Filters</h5>
                </div>
                <div class="card-body">
                    <form method="get" action="{{ path('nowo_performance_index') }}" class="row g-3">
                        <div class="col-md-3">
                            <label for="env" class="form-label">Environment</label>
                            <select name="env" id="env" class="form-select">
                                {% for envOption in environments %}
                                    <option value="{{ envOption }}" {{ envOption == environment ? 'selected' : '' }}>
                                        {{ envOption|upper }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="route" class="form-label">Route Name</label>
                            <input type="text" name="route" id="route" class="form-control" 
                                   value="{{ currentRoute }}" placeholder="Filter by route name...">
                        </div>
                        <div class="col-md-2">
                            <label for="sort" class="form-label">Sort By</label>
                            <select name="sort" id="sort" class="form-select">
                                <option value="requestTime" {{ sortBy == 'requestTime' ? 'selected' : '' }}>Request Time</option>
                                <option value="queryTime" {{ sortBy == 'queryTime' ? 'selected' : '' }}>Query Time</option>
                                <option value="totalQueries" {{ sortBy == 'totalQueries' ? 'selected' : '' }}>Queries</option>
                                <option value="name" {{ sortBy == 'name' ? 'selected' : '' }}>Route Name</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="order" class="form-label">Order</label>
                            <select name="order" id="order" class="form-select">
                                <option value="DESC" {{ order == 'DESC' ? 'selected' : '' }}>Descending</option>
                                <option value="ASC" {{ order == 'ASC' ? 'selected' : '' }}>Ascending</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="limit" class="form-label">Limit</label>
                            <input type="number" name="limit" id="limit" class="form-control" 
                                   value="{{ limit }}" min="1" max="1000">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <a href="{{ path('nowo_performance_index') }}" class="btn btn-secondary">Reset</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {# Routes Table #}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Routes ({{ routes|length }})</h5>
                </div>
                <div class="card-body">
                    {% if routes is empty %}
                        <div class="alert alert-info">
                            <p class="mb-0">No routes found for the selected filters.</p>
                        </div>
                    {% else %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Route Name</th>
                                        <th>Environment</th>
                                        <th>Request Time</th>
                                        <th>Query Time</th>
                                        <th>Total Queries</th>
                                        <th>Updated At</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for route in routes %}
                                        <tr>
                                            <td>
                                                <code>{{ route.name ?? 'N/A' }}</code>
                                            </td>
                                            <td>
                                                <span class="badge bg-secondary">{{ route.env ?? 'N/A' }}</span>
                                            </td>
                                            <td>
                                                {% if route.requestTime %}
                                                    <span class="badge {{ route.requestTime > 1 ? 'bg-danger' : (route.requestTime > 0.5 ? 'bg-warning' : 'bg-success') }}">
                                                        {{ (route.requestTime * 1000)|number_format(2) }} ms
                                                    </span>
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if route.queryTime %}
                                                    <span class="badge bg-info">
                                                        {{ (route.queryTime * 1000)|number_format(2) }} ms
                                                    </span>
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if route.totalQueries %}
                                                    <span class="badge {{ route.totalQueries > 50 ? 'bg-danger' : (route.totalQueries > 20 ? 'bg-warning' : 'bg-success') }}">
                                                        {{ route.totalQueries }}
                                                    </span>
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if route.updatedAt %}
                                                    {{ route.updatedAt|date('Y-m-d H:i:s') }}
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
