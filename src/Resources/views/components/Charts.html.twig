{% if template == 'bootstrap' %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Performance Trends</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="chart-metric" class="form-label">Metric:</label>
                        <select id="chart-metric" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                            <option value="requestTime">Request Time</option>
                            <option value="queryTime">Query Time</option>
                            <option value="totalQueries">Total Queries</option>
                            <option value="memoryUsage">Memory Usage</option>
                        </select>
                        <label for="chart-days" class="form-label ms-3">Days:</label>
                        <select id="chart-days" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                        </select>
                    </div>
                    <canvas id="performanceChart" style="max-height: 400px;"></canvas>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <div class="mb-8">
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Performance Trends</h3>
            </div>
            <div class="p-6">
                <div class="mb-4 flex items-center gap-4">
                    <div>
                        <label for="chart-metric" class="block text-sm font-medium text-gray-700 mb-1">Metric:</label>
                        <select id="chart-metric" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="requestTime">Request Time</option>
                            <option value="queryTime">Query Time</option>
                            <option value="totalQueries">Total Queries</option>
                            <option value="memoryUsage">Memory Usage</option>
                        </select>
                    </div>
                    <div>
                        <label for="chart-days" class="block text-sm font-medium text-gray-700 mb-1">Days:</label>
                        <select id="chart-days" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                        </select>
                    </div>
                </div>
                <div class="relative" style="height: 400px;">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof Chart === 'undefined') return;

    const env = '{{ environment }}';
    const routeName = '{{ currentRoute ?? '' }}';
    const chartDataUrl = '{{ chartDataUrl }}';
    let chart = null;

    function loadChartData(metric, days) {
        const url = new URL(chartDataUrl, window.location.origin);
        url.searchParams.set('env', env);
        url.searchParams.set('metric', metric);
        url.searchParams.set('days', days);
        if (routeName) {
            url.searchParams.set('route', routeName);
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (chart) {
                    chart.destroy();
                }

                const canvas = document.getElementById('performanceChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: {% if template == 'bootstrap' %}true{% else %}false{% endif %},
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Error loading chart data:', error);
            });
    }

    // Initial load
    loadChartData('requestTime', 7);

    // Update on change
    const chartMetric = document.getElementById('chart-metric');
    const chartDays = document.getElementById('chart-days');
    if (chartMetric) {
        chartMetric.addEventListener('change', function() {
            loadChartData(this.value, document.getElementById('chart-days')?.value || '7');
        });
    }
    if (chartDays) {
        chartDays.addEventListener('change', function() {
            loadChartData(document.getElementById('chart-metric')?.value || 'requestTime', this.value);
        });
    }
});
</script>
